# Fine-Tuning Lightweight Stable Diffusion for Image-to-Image Generation

This repository demonstrates how to fine-tune a lightweight Stable Diffusion model for image-to-image generation. The project consists of two primary notebooks:

1. **Image Generation Notebook**: This notebook uses a pre-trained Stable Diffusion model to generate new images based on the CIFAR-10 dataset.
2. **Fine-Tuning Notebook**: This notebook fine-tunes the Stable Diffusion model on custom data to enhance its image generation capabilities.

## Requirements

To run the notebooks in this repository, the following software and libraries are required:

- **Python 3.7+**
- **Google Colab** (recommended for cloud execution)
- **GPU** (recommended for faster execution, though the model can also run on CPU)
- The following Python libraries:
  - `torch` (for tensor operations and model handling)
  - `torchvision` (for dataset manipulation and transformations)
  - `diffusers` (for working with Stable Diffusion models)
  - `PIL` (for image handling and transformations)
  - `google.colab` (for mounting Google Drive in Colab)

### Installation

If running locally or on your own Colab environment, install the required libraries using `pip`.

## Setup

### 1. Mount Google Drive

The images generated by the model are saved to your Google Drive for easy access. You will need to mount your Google Drive in Google Colab to store the output images.

### 2. Device Setup

The notebooks are designed to automatically detect whether a GPU or CPU is available. If a GPU is available, it will be used for faster processing.

## Workflow

### 1. Image Generation Notebook

This notebook focuses on generating new images based on the CIFAR-10 dataset by leveraging a pre-trained Stable Diffusion model.

- **Model**: The model used is a lightweight version of Stable Diffusion (`stabilityai/stable-diffusion-2-1-base`), which is optimized for faster image generation while maintaining high-quality results.
- **Dataset**: The CIFAR-10 dataset is used, consisting of 60,000 32x32 color images across 10 classes. Images are resized to 512x512 resolution for generation.
- **Generation Process**: A fixed prompt (e.g., "A realistic photo") is used to generate images based on the original CIFAR-10 images, with parameters such as `strength` and `guidance_scale` to control the generation.
- **Output**: The generated images are saved in a directory in your Google Drive, and the labels from the CIFAR-10 dataset are displayed for reference.

### 2. Fine-Tuning Notebook

In this notebook, the pre-trained Stable Diffusion model is fine-tuned on a custom dataset to improve the quality of image generation for specific tasks.

#### Key Steps:

- **Dataset Preparation**: Custom images are used for fine-tuning. The dataset should consist of images relevant to the intended image generation task.
- **Model Freezing**: To preserve the knowledge from the pre-trained model, some layers are frozen while the later layers are fine-tuned on the new dataset.
- **Fine-Tuning**: The model is trained using a lower learning rate to allow gradual learning without overfitting. The fine-tuning process helps the model adapt to the characteristics of the custom dataset.
- **Output**: After fine-tuning, the model should generate higher-quality images that align more closely with the features present in the custom dataset.

## Example Usage

After running the Image Generation Notebook, We can download and view the generated images saved in your Google Drive. 
For the Fine-Tuning Notebook, let's follow these steps:

1. Use the CIFAR-10 dataset, which is already included and loaded in the notebook.
2. Run the fine-tuning script to adapt the pre-trained Stable Diffusion model on the CIFAR-10 dataset.
3. Save the fine-tuned model and use it for generating improved images based on the CIFAR-10 dataset.


## Output Images

Here are some of the generated images:

![image alt](https://github.com/IsratIJK/Assessment-2-Nagorik/blob/main/Output-images/generated_image_2.jpg?raw=true)
![image alt](https://github.com/IsratIJK/Assessment-2-Nagorik/blob/main/Output-images/generated_image_5.jpg?raw=true)
![image alt](https://github.com/IsratIJK/Assessment-2-Nagorik/blob/main/Output-images/generated_image_8.jpg?raw=true)


